<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Habits - Статистика</title>
    <link rel="stylesheet" href="design-system.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;707;800&family=Quicksand:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Telegram WebApp API -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="telegram-webapp.js"></script>
    
    <style>
        .stats-hero {
            text-align: center;
            padding: var(--spacing-lg) 0;
            background: linear-gradient(135deg, rgba(168, 201, 138, 0.1) 0%, rgba(184, 216, 186, 0.1) 100%);
            border-radius: var(--border-radius-xl);
            margin-bottom: var(--spacing-lg);
            border: 1px solid rgba(168, 201, 138, 0.3);
        }
        
        .time-period-selector {
            display: flex;
            gap: var(--spacing-xs);
            margin: var(--spacing-md) 0;
            overflow-x: auto;
            padding-bottom: var(--spacing-xs);
        }
        
        .period-tab {
            background: var(--bg-elevated);
            border: 2px solid rgba(107, 142, 78, 0.2);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-sm) var(--spacing-md);
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-size: var(--text-sm);
            font-weight: var(--font-semibold);
        }
        
        .period-tab:hover {
            border-color: var(--primary-green);
        }
        
        .period-tab.active {
            border-color: var(--primary-green);
            background: rgba(107, 142, 78, 0.1);
            color: var(--primary-green);
        }
        
        .chart-container {
            background: var(--bg-card);
            border: 1px solid rgba(107, 142, 78, 0.2);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
            position: relative;
            height: 300px;
        }
        
        .chart-title {
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
            text-align: center;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: var(--spacing-sm);
            margin: var(--spacing-lg) 0;
        }
        
        .metric-card {
            background: var(--bg-card);
            border: 1px solid rgba(107, 142, 78, 0.2);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-md);
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-elevated);
            border-color: var(--primary-green);
        }
        
        .metric-card.highlight {
            border: 2px solid var(--accent-green);
            background: linear-gradient(135deg, rgba(123, 160, 91, 0.1) 0%, rgba(168, 201, 138, 0.1) 100%);
        }
        
        .metric-icon {
            font-size: 2rem;
            margin-bottom: var(--spacing-sm);
        }
        
        .metric-value {
            font-size: var(--text-2xl);
            font-weight: var(--font-extrabold);
            color: var(--primary-green);
            display: block;
            margin-bottom: var(--spacing-xs);
        }
        
        .metric-label {
            font-size: var(--text-sm);
            color: var(--text-primary);
            font-weight: var(--font-semibold);
            margin-bottom: var(--spacing-xs);
        }
        
        .metric-change {
            font-size: var(--text-xs);
            padding: var(--spacing-xs);
            border-radius: var(--border-radius);
            font-weight: var(--font-medium);
        }
        
        .metric-change.positive {
            background: rgba(123, 160, 91, 0.2);
            color: var(--accent-green);
        }
        
        .metric-change.negative {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }
        
        .leaderboard {
            background: var(--bg-elevated);
            border: 1px solid rgba(107, 142, 78, 0.2);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-md);
            margin: var(--spacing-lg) 0;
        }
        
        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm);
            background: var(--bg-card);
            border: 1px solid rgba(107, 142, 78, 0.2);
            border-radius: var(--border-radius);
            margin: var(--spacing-sm) 0;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .leaderboard-item:hover {
            border-color: var(--primary-green);
            transform: translateX(4px);
        }
        
        .leaderboard-item.current-user {
            border: 2px solid var(--accent-green);
            background: rgba(123, 160, 91, 0.1);
        }
        
        .leaderboard-rank {
            width: 32px;
            height: 32px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: var(--font-bold);
            color: white;
            flex-shrink: 0;
        }
        
        .leaderboard-rank.gold {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        }
        
        .leaderboard-rank.silver {
            background: linear-gradient(135deg, #C0C0C0 0%, #808080 100%);
        }
        
        .leaderboard-rank.bronze {
            background: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%);
        }
        
        .leaderboard-avatar {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            border: 2px solid var(--primary-green);
            flex-shrink: 0;
        }
        
        .leaderboard-info {
            flex-grow: 1;
        }
        
        .leaderboard-name {
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            font-size: var(--text-sm);
        }
        
        .leaderboard-details {
            font-size: var(--text-xs);
            color: var(--text-muted);
        }
        
        .leaderboard-score {
            background: var(--gradient-reward);
            color: var(--text-primary);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius);
            font-size: var(--text-sm);
            font-weight: var(--font-bold);
            border: 1px solid var(--accent-green);
        }
        
        .trend-indicator {
            position: absolute;
            top: var(--spacing-xs);
            right: var(--spacing-xs);
            font-size: var(--text-xs);
            padding: var(--spacing-xs);
            border-radius: var(--border-radius);
            font-weight: var(--font-bold);
        }
        
        .trend-up {
            background: rgba(123, 160, 91, 0.2);
            color: var(--accent-green);
        }
        
        .trend-down {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }
        
        .insights-section {
            background: rgba(184, 216, 186, 0.1);
            border: 1px solid var(--mint-green);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-md);
            margin: var(--spacing-lg) 0;
        }
        
        .insight-item {
            background: var(--bg-card);
            border: 1px solid rgba(107, 142, 78, 0.2);
            border-radius: var(--border-radius);
            padding: var(--spacing-sm);
            margin: var(--spacing-sm) 0;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .insight-icon {
            width: 32px;
            height: 32px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            flex-shrink: 0;
        }
        
        .goals-progress {
            background: rgba(156, 175, 136, 0.1);
            border: 1px solid var(--sage-green);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-md);
            margin: var(--spacing-lg) 0;
        }
        
        .goal-item {
            margin: var(--spacing-md) 0;
        }
        
        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xs);
        }
        
        .goal-name {
            font-weight: var(--font-semibold);
            color: var(--text-primary);
        }
        
        .goal-percentage {
            background: var(--gradient-reward);
            color: var(--text-primary);
            padding: var(--spacing-xs);
            border-radius: var(--border-radius);
            font-size: var(--text-xs);
            font-weight: var(--font-bold);
            border: 1px solid var(--accent-green);
        }
        
        .goal-progress {
            height: 8px;
            background: rgba(107, 142, 78, 0.1);
            border-radius: var(--border-radius);
            overflow: hidden;
            position: relative;
        }
        
        .goal-progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: var(--border-radius);
            transition: width 0.8s ease;
            position: relative;
        }
        
        .goal-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Заголовок -->
        <div class="stats-hero">
            <div class="mascot-container">
                <div class="mascot">📊</div>
                <div class="mascot mascot-punk">📈</div>
            </div>
            <h1 class="heading-1 text-neon">Статистика семьи</h1>
            <p class="text-secondary">Хабит и Хабби проанализировали ваши успехи!</p>
        </div>

        <!-- Выбор периода -->
        <div class="time-period-selector">
            <div class="period-tab active" data-period="week">📅 Неделя</div>
            <div class="period-tab" data-period="month">🗓️ Месяц</div>
            <div class="period-tab" data-period="quarter">📊 Квартал</div>
            <div class="period-tab" data-period="year">📆 Год</div>
            <div class="period-tab" data-period="all">🌟 Все время</div>
        </div>

        <!-- Основные метрики -->
        <section id="mainMetrics">
            <h2 class="heading-2">🎯 Основные показатели</h2>
            <div class="metrics-grid">
                <div class="metric-card highlight">
                    <div class="trend-indicator trend-up">↗️ +15%</div>
                    <div class="metric-icon">✅</div>
                    <span class="metric-value">89</span>
                    <div class="metric-label">Задач выполнено</div>
                    <div class="metric-change positive">+12 на этой неделе</div>
                </div>
                
                <div class="metric-card">
                    <div class="trend-indicator trend-up">↗️ +8%</div>
                    <div class="metric-icon">⭐</div>
                    <span class="metric-value">1,247</span>
                    <div class="metric-label">Звезд заработано</div>
                    <div class="metric-change positive">+95 на этой неделе</div>
                </div>
                
                <div class="metric-card">
                    <div class="trend-indicator trend-up">↗️ +2</div>
                    <div class="metric-icon">🔥</div>
                    <span class="metric-value">12</span>
                    <div class="metric-label">Дней подряд</div>
                    <div class="metric-change positive">Личный рекорд!</div>
                </div>
                
                <div class="metric-card">
                    <div class="trend-indicator trend-up">↗️ +5%</div>
                    <div class="metric-icon">👨‍👩‍👧‍👦</div>
                    <span class="metric-value">85%</span>
                    <div class="metric-label">Участие семьи</div>
                    <div class="metric-change positive">Отличный результат</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-icon">🎁</div>
                    <span class="metric-value">23</span>
                    <div class="metric-label">Наград получено</div>
                    <div class="metric-change positive">+3 на этой неделе</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-icon">⏱️</div>
                    <span class="metric-value">4.2</span>
                    <div class="metric-label">Среднее время</div>
                    <div class="metric-change positive">мин на задачу</div>
                </div>
            </div>
        </section>

        <!-- График активности -->
        <section>
            <div class="chart-container">
                <div class="chart-title">📈 Активность семьи за неделю</div>
                <canvas id="activityChart"></canvas>
            </div>
        </section>

        <!-- Лидерборд семьи -->
        <div class="leaderboard">
            <h3 class="heading-3">🏆 Рейтинг семьи</h3>
            <p class="text-secondary">Звезды за текущую неделю:</p>
            
            <div class="leaderboard-item">
                <div class="leaderboard-rank gold">1</div>
                <div class="leaderboard-avatar">👦</div>
                <div class="leaderboard-info">
                    <div class="leaderboard-name">Максим</div>
                    <div class="leaderboard-details">12 лет • 8 задач выполнено</div>
                </div>
                <div class="leaderboard-score">⭐ 145</div>
            </div>
            
            <div class="leaderboard-item current-user">
                <div class="leaderboard-rank silver">2</div>
                <div class="leaderboard-avatar">👨‍💼</div>
                <div class="leaderboard-info">
                    <div class="leaderboard-name">Алексей (Вы)</div>
                    <div class="leaderboard-details">Родитель • 6 задач выполнено</div>
                </div>
                <div class="leaderboard-score">⭐ 132</div>
            </div>
            
            <div class="leaderboard-item">
                <div class="leaderboard-rank bronze">3</div>
                <div class="leaderboard-avatar">👩</div>
                <div class="leaderboard-info">
                    <div class="leaderboard-name">Мария</div>
                    <div class="leaderboard-details">Родитель • 5 задач выполнено</div>
                </div>
                <div class="leaderboard-score">⭐ 98</div>
            </div>
            
            <div class="leaderboard-item">
                <div class="leaderboard-rank">4</div>
                <div class="leaderboard-avatar">👧</div>
                <div class="leaderboard-info">
                    <div class="leaderboard-name">София</div>
                    <div class="leaderboard-details">8 лет • 4 задачи выполнено</div>
                </div>
                <div class="leaderboard-score">⭐ 76</div>
            </div>
        </div>

        <!-- Прогресс целей -->
        <div class="goals-progress">
            <h3 class="heading-3">🎯 Прогресс семейных целей</h3>
            
            <div class="goal-item">
                <div class="goal-header">
                    <span class="goal-name">🏠 Поддержание порядка дома</span>
                    <span class="goal-percentage">78%</span>
                </div>
                <div class="goal-progress">
                    <div class="goal-progress-fill" style="width: 78%"></div>
                </div>
            </div>
            
            <div class="goal-item">
                <div class="goal-header">
                    <span class="goal-name">📚 Образование и развитие</span>
                    <span class="goal-percentage">92%</span>
                </div>
                <div class="goal-progress">
                    <div class="goal-progress-fill" style="width: 92%"></div>
                </div>
            </div>
            
            <div class="goal-item">
                <div class="goal-header">
                    <span class="goal-name">🌱 Здоровые привычки</span>
                    <span class="goal-percentage">65%</span>
                </div>
                <div class="goal-progress">
                    <div class="goal-progress-fill" style="width: 65%"></div>
                </div>
            </div>
            
            <div class="goal-item">
                <div class="goal-header">
                    <span class="goal-name">👨‍👩‍👧‍👦 Семейное время</span>
                    <span class="goal-percentage">85%</span>
                </div>
                <div class="goal-progress">
                    <div class="goal-progress-fill" style="width: 85%"></div>
                </div>
            </div>
        </div>

        <!-- Инсайты и рекомендации -->
        <div class="insights-section">
            <h3 class="heading-3">💡 Анализ и рекомендации</h3>
            
            <div class="insight-item">
                <div class="insight-icon">🔥</div>
                <div>
                    <strong>Отличная активность!</strong> Ваша семья показывает стабильный рост выполнения задач. Максим особенно мотивирован!
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-icon">⏰</div>
                <div>
                    <strong>Оптимальное время:</strong> Больше всего задач выполняется утром (7-9) и вечером (18-20). Планируйте важные дела на это время.
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-icon">🎯</div>
                <div>
                    <strong>Фокус на здоровье:</strong> Рекомендуем добавить больше задач, связанных со спортом и правильным питанием для Софии.
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-icon">🏆</div>
                <div>
                    <strong>Семейные челленджи:</strong> Попробуйте создать общую цель на выходные - это увеличит командную работу на 25%!
                </div>
            </div>
        </div>

        <!-- График распределения задач -->
        <section>
            <div class="chart-container">
                <div class="chart-title">🥧 Распределение типов задач</div>
                <canvas id="tasksChart"></canvas>
            </div>
        </section>

        <!-- Навигация -->
        <div class="flex gap-sm" style="margin-top: var(--spacing-xl);">
            <button class="btn btn-secondary" onclick="exportReport()">
                📊 Экспорт отчета
            </button>
            <button class="btn btn-secondary" onclick="shareStats()">
                📤 Поделиться
            </button>
            <button class="btn btn-ghost" onclick="goBack()">
                ⬅️ Назад
            </button>
        </div>

        <!-- Поощрение от талисманов -->
        <div class="text-center" style="margin: var(--spacing-xl) 0;">
            <div class="mascot-container">
                <div class="mascot">📊</div>
                <div class="mascot mascot-punk">📈</div>
            </div>
            <p class="text-muted">Хабит и Хабби анализируют данные 24/7!</p>
            <p class="text-neon text-gaming">Data Drives Success!</p>
        </div>
    </div>

    <script>
        // Переключение периодов
        document.querySelectorAll('.period-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.period-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                const period = tab.dataset.period;
                updateStatistics(period);
            });
        });

        function updateStatistics(period) {
            console.log(`Обновление статистики за: ${period}`);
            // В реальном приложении здесь был бы запрос к API
            
            // Анимация обновления метрик
            document.querySelectorAll('.metric-value').forEach(metric => {
                metric.style.animation = 'pulse 0.5s ease-out';
            });
            
            // Обновление графиков
            updateCharts(period);
        }

        // Инициализация графика активности
        const activityCtx = document.getElementById('activityChart').getContext('2d');
        const activityChart = new Chart(activityCtx, {
            type: 'line',
            data: {
                labels: ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'],
                datasets: [{
                    label: 'Выполненные задачи',
                    data: [12, 15, 8, 18, 22, 16, 14],
                    borderColor: '#6B8E4E',
                    backgroundColor: 'rgba(107, 142, 78, 0.1)',
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: '#7BA05B',
                    pointBorderColor: '#6B8E4E',
                    pointRadius: 6,
                    pointHoverRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(107, 142, 78, 0.1)'
                        },
                        ticks: {
                            color: '#6B8E4E'
                        }
                    },
                    x: {
                        grid: {
                            color: 'rgba(107, 142, 78, 0.1)'
                        },
                        ticks: {
                            color: '#6B8E4E'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });

        // Инициализация круговой диаграммы
        const tasksCtx = document.getElementById('tasksChart').getContext('2d');
        const tasksChart = new Chart(tasksCtx, {
            type: 'doughnut',
            data: {
                labels: ['Уборка', 'Учеба', 'Спорт', 'Творчество', 'Семейное время'],
                datasets: [{
                    data: [25, 30, 15, 20, 10],
                    backgroundColor: [
                        '#6B8E4E',
                        '#7BA05B',
                        '#A8C98A',
                        '#B8D8BA',
                        '#9CAF88'
                    ],
                    borderColor: '#ffffff',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#6B8E4E',
                            padding: 15,
                            usePointStyle: true
                        }
                    }
                }
            }
        });

        function updateCharts(period) {
            // Обновление данных графиков в зависимости от выбранного периода
            const newData = generateDataForPeriod(period);
            
            activityChart.data.datasets[0].data = newData.activity;
            activityChart.update('active');
            
            tasksChart.data.datasets[0].data = newData.tasks;
            tasksChart.update('active');
        }

        function generateDataForPeriod(period) {
            // Симуляция данных для разных периодов
            const data = {
                week: {
                    activity: [12, 15, 8, 18, 22, 16, 14],
                    tasks: [25, 30, 15, 20, 10]
                },
                month: {
                    activity: [45, 52, 38, 61, 73, 58, 49],
                    tasks: [28, 35, 12, 18, 7]
                },
                quarter: {
                    activity: [156, 178, 134, 201, 245, 189, 167],
                    tasks: [32, 38, 10, 15, 5]
                },
                year: {
                    activity: [624, 712, 536, 804, 980, 756, 668],
                    tasks: [35, 40, 8, 12, 5]
                },
                all: {
                    activity: [1248, 1424, 1072, 1608, 1960, 1512, 1336],
                    tasks: [38, 42, 6, 10, 4]
                }
            };
            
            return data[period] || data.week;
        }

        function exportReport() {
            alert('📊 Функция экспорта отчета скоро появится!\n\nВ полной версии вы сможете:\n• Скачать PDF отчет\n• Экспортировать в Excel\n• Отправить на email\n• Сохранить в облако');
        }

        function shareStats() {
            alert('📤 Функция "Поделиться статистикой" скоро появится!\n\nВ полной версии можно будет:\n• Поделиться достижениями\n• Отправить отчет родственникам\n• Опубликовать в соцсетях\n• Сравнить с другими семьями');
        }

        function goBack() {
            window.location.href = 'profile.html';
        }

        // Анимация появления элементов
        document.addEventListener('DOMContentLoaded', () => {
            // Анимация метрик
            const metrics = document.querySelectorAll('.metric-card');
            metrics.forEach((metric, index) => {
                setTimeout(() => {
                    metric.style.animation = 'star-burst 0.6s ease-out';
                }, index * 100);
            });

            // Анимация прогресс-баров целей
            setTimeout(() => {
                const goalBars = document.querySelectorAll('.goal-progress-fill');
                goalBars.forEach((bar, index) => {
                    setTimeout(() => {
                        const width = bar.style.width;
                        bar.style.width = '0%';
                        bar.offsetHeight; // Trigger reflow
                        bar.style.width = width;
                    }, index * 200);
                });
            }, 500);

            // Анимация лидерборда
            const leaderboardItems = document.querySelectorAll('.leaderboard-item');
            leaderboardItems.forEach((item, index) => {
                setTimeout(() => {
                    item.style.transform = 'translateX(-20px)';
                    item.style.opacity = '0';
                    item.offsetHeight; // Trigger reflow
                    item.style.transform = 'translateX(0)';
                    item.style.opacity = '1';
                    item.style.transition = 'all 0.5s ease-out';
                }, index * 150);
            });
        });
    </script>
</body>
</html>