<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Habits - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
    <link rel="stylesheet" href="design-system.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Quicksand:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Telegram WebApp API -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="telegram-webapp.js"></script>
    
    <style>
        body {
            background: var(--gradient-hero);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .registration-container {
            max-width: 500px;
            margin: 0 auto;
            padding: var(--spacing-lg);
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: var(--spacing-xl);
            gap: var(--spacing-sm);
        }

        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .step.active {
            background: var(--primary-green);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
        }

        .step.completed {
            background: var(--success-green);
        }

        .step-content {
            background: rgba(255,255,255,0.95);
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-lg);
            border: 2px solid var(--primary-green);
        }

        .step-title {
            color: var(--primary-green);
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: var(--spacing-md);
            text-align: center;
        }

        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: 600;
            color: var(--text-dark);
        }

        .form-input {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius-lg);
            font-size: 1rem;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.2);
        }

        .form-input.error {
            border-color: var(--error-red);
            box-shadow: 0 0 10px rgba(244, 67, 54, 0.2);
        }

        .form-select {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius-lg);
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary-green);
        }

        .error-message {
            color: var(--error-red);
            font-size: 0.9em;
            margin-top: var(--spacing-xs);
            display: none;
        }

        .info-text {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid var(--primary-green);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            color: var(--text-dark);
            font-size: 0.9em;
        }

        .mascot-helper {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            background: rgba(76, 175, 80, 0.1);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .mascot-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }

        .next-button {
            width: 100%;
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: var(--spacing-md);
            border-radius: var(--border-radius-lg);
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: var(--spacing-lg);
        }

        .next-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .next-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .back-button {
            background: transparent;
            color: var(--primary-green);
            border: 2px solid var(--primary-green);
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            margin-right: var(--spacing-md);
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-sm);
            margin: var(--spacing-md) 0;
        }

        .checkbox-group input[type="checkbox"] {
            margin-top: 4px;
        }

        .checkbox-group label {
            font-size: 0.9em;
            line-height: 1.4;
        }

        .step-content.hidden {
            display: none;
        }

        .telegram-info {
            background: rgba(33, 150, 243, 0.1);
            border: 1px solid #2196F3;
            border-radius: var(--border-radius-md);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .telegram-info h4 {
            color: #1976D2;
            margin-bottom: var(--spacing-sm);
        }

        .radio-group {
            display: flex;
            gap: var(--spacing-lg);
            margin: var(--spacing-md) 0;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        @media (max-width: 480px) {
            .registration-container {
                padding: var(--spacing-md);
            }
            
            .radio-group {
                flex-direction: column;
                gap: var(--spacing-md);
            }
        }
    </style>
</head>
<body>
    <div class="registration-container">
        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ -->
        <div class="step-indicator">
            <div class="step active" id="step-1">1</div>
            <div class="step" id="step-2">2</div>
            <div class="step" id="step-3">3</div>
            <div class="step" id="step-4">4</div>
        </div>

        <!-- –®–∞–≥ 1: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="step-content" id="content-1">
            <div class="mascot-helper">
                <div class="mascot-avatar">üå±</div>
                <div>
                    <strong>Habit:</strong> –î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é! –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏–º –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ Telegram.
                </div>
            </div>

            <h2 class="step-title">üìã –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ</h2>
            
            <div class="telegram-info">
                <h4>üì± –î–∞–Ω–Ω—ã–µ –∏–∑ Telegram:</h4>
                <div id="telegram-data">–ó–∞–≥—Ä—É–∂–∞–µ–º...</div>
            </div>

            <div class="form-group">
                <label for="user-name" class="form-label">–ò–º—è *</label>
                <input type="text" id="user-name" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" minlength="3" required>
                <div class="error-message" id="name-error">–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 –±—É–∫–≤—ã</div>
            </div>

            <div class="form-group">
                <label for="user-phone" class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                <input type="tel" id="user-phone" class="form-input" placeholder="+7 (999) 123-45-67" required>
                <div class="error-message" id="phone-error">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</div>
            </div>

            <button class="next-button" onclick="nextStep(1)" disabled id="next-1">
                –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Üí
            </button>
        </div>

        <!-- –®–∞–≥ 2: –†–µ–≥–∏–æ–Ω –∏ —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å -->
        <div class="step-content hidden" id="content-2">
            <div class="mascot-helper">
                <div class="mascot-avatar">üçÉ</div>
                <div>
                    <strong>Habby:</strong> –¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à —Ä–µ–≥–∏–æ–Ω. –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞–¥–∞—á–∞—Ö!
                </div>
            </div>

            <h2 class="step-title">üåç –†–µ–≥–∏–æ–Ω –∏ —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å</h2>
            
            <div class="info-text">
                üí° <strong>–ó–∞—á–µ–º –Ω—É–∂–µ–Ω —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å?</strong><br>
                –ú—ã –±—É–¥–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø—Ä–∏–≤—ã—á–µ–∫ –≤ —É–¥–æ–±–Ω–æ–µ –¥–ª—è –≤–∞—Å –≤—Ä–µ–º—è –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å.
            </div>

            <div class="form-group">
                <label for="timezone" class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à —Ä–µ–≥–∏–æ–Ω *</label>
                <select id="timezone" class="form-select" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω...</option>
                    <option value="Europe/Moscow">–ú–æ—Å–∫–≤–∞, –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ (UTC+3)</option>
                    <option value="Europe/Samara">–°–∞–º–∞—Ä–∞, –ò–∂–µ–≤—Å–∫ (UTC+4)</option>
                    <option value="Asia/Yekaterinburg">–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥, –ü–µ—Ä–º—å (UTC+5)</option>
                    <option value="Asia/Omsk">–û–º—Å–∫ (UTC+6)</option>
                    <option value="Asia/Krasnoyarsk">–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫, –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫ (UTC+7)</option>
                    <option value="Asia/Irkutsk">–ò—Ä–∫—É—Ç—Å–∫, –£–ª–∞–Ω-–£–¥—ç (UTC+8)</option>
                    <option value="Asia/Yakutsk">–Ø–∫—É—Ç—Å–∫ (UTC+9)</option>
                    <option value="Asia/Vladivostok">–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫, –•–∞–±–∞—Ä–æ–≤—Å–∫ (UTC+10)</option>
                    <option value="Asia/Magadan">–ú–∞–≥–∞–¥–∞–Ω (UTC+11)</option>
                    <option value="Asia/Kamchatka">–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫-–ö–∞–º—á–∞—Ç—Å–∫–∏–π (UTC+12)</option>
                </select>
                <div class="error-message" id="timezone-error">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å</div>
            </div>

            <div class="form-group">
                <label for="city" class="form-label">–ì–æ—Ä–æ–¥ *</label>
                <input type="text" id="city" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞" pattern="[–ê-–Ø–∞-—è–Å—ë\s\-]+" required>
                <div class="error-message" id="city-error">–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã</div>
            </div>

            <div style="display: flex; gap: var(--spacing-md);">
                <button class="back-button" onclick="prevStep(2)">‚Üê –ù–∞–∑–∞–¥</button>
                <button class="next-button" onclick="nextStep(2)" disabled id="next-2" style="flex: 1;">
                    –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Üí
                </button>
            </div>
        </div>

        <!-- –®–∞–≥ 3: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ–±–µ–Ω–∫–∞ -->
        <div class="step-content hidden" id="content-3">
            <div class="mascot-helper">
                <div class="mascot-avatar">üå±</div>
                <div>
                    <strong>Habit:</strong> –û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –≤–∞—à–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞ –≤ Family Habits.
                </div>
            </div>

            <h2 class="step-title">üë∂ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ–±–µ–Ω–∫–∞</h2>

            <div class="form-group">
                <label for="child-name" class="form-label">–ò–º—è —Ä–µ–±–µ–Ω–∫–∞ *</label>
                <input type="text" id="child-name" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ä–µ–±–µ–Ω–∫–∞" minlength="2" required>
                <div class="error-message" id="child-name-error">–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 –±—É–∫–≤—ã</div>
            </div>

            <div class="form-group">
                <label for="child-age" class="form-label">–í–æ–∑—Ä–∞—Å—Ç *</label>
                <select id="child-age" class="form-select" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç...</option>
                    <option value="5">5 –ª–µ—Ç</option>
                    <option value="6">6 –ª–µ—Ç</option>
                    <option value="7">7 –ª–µ—Ç</option>
                    <option value="8">8 –ª–µ—Ç</option>
                    <option value="9">9 –ª–µ—Ç</option>
                    <option value="10">10 –ª–µ—Ç</option>
                    <option value="11">11 –ª–µ—Ç</option>
                    <option value="12">12 –ª–µ—Ç</option>
                    <option value="13">13 –ª–µ—Ç</option>
                    <option value="14">14 –ª–µ—Ç</option>
                    <option value="15">15 –ª–µ—Ç</option>
                    <option value="16">16 –ª–µ—Ç</option>
                </select>
                <div class="error-message" id="child-age-error">–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç —Ä–µ–±–µ–Ω–∫–∞</div>
            </div>

            <div class="form-group">
                <label class="form-label">–ü–æ–ª *</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="gender-boy" name="child-gender" value="boy" required>
                        <label for="gender-boy">üë¶ –ú–∞–ª—å—á–∏–∫</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="gender-girl" name="child-gender" value="girl" required>
                        <label for="gender-girl">üëß –î–µ–≤–æ—á–∫–∞</label>
                    </div>
                </div>
                <div class="error-message" id="gender-error">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª —Ä–µ–±–µ–Ω–∫–∞</div>
            </div>

            <div style="display: flex; gap: var(--spacing-md);">
                <button class="back-button" onclick="prevStep(3)">‚Üê –ù–∞–∑–∞–¥</button>
                <button class="next-button" onclick="nextStep(3)" disabled id="next-3" style="flex: 1;">
                    –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Üí
                </button>
            </div>
        </div>

        <!-- –®–∞–≥ 4: –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ -->
        <div class="step-content hidden" id="content-4">
            <div class="mascot-helper">
                <div class="mascot-avatar">üçÉ</div>
                <div>
                    <strong>Habby:</strong> –ü–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–≥! –û–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏.
                </div>
            </div>

            <h2 class="step-title">üîí –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</h2>

            <div class="info-text">
                <h4>–ú—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º:</h4>
                <ul>
                    <li>üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤–∞—à–µ–π —Å–µ–º—å–∏</li>
                    <li>üö´ –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞–¥–∏–º –¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º</li>
                    <li>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –î–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</li>
                    <li>üóëÔ∏è –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç</li>
                </ul>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="privacy-agreement" required>
                <label for="privacy-agreement">
                    –Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å <a href="#" onclick="showPrivacyPolicy()">–ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a> –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö *
                </label>
            </div>
            <div class="error-message" id="privacy-error">–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</div>

            <div class="checkbox-group">
                <input type="checkbox" id="notifications-agreement">
                <label for="notifications-agreement">
                    –Ø —Å–æ–≥–ª–∞—Å–µ–Ω –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
                </label>
            </div>

            <div style="display: flex; gap: var(--spacing-md);">
                <button class="back-button" onclick="prevStep(4)">‚Üê –ù–∞–∑–∞–¥</button>
                <button class="next-button" onclick="completeRegistration()" disabled id="next-4" style="flex: 1;">
                    üéâ –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
                </button>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tgApp = new TelegramWebApp();
        let currentStep = 1;
        let formData = {};

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Telegram
        tgApp.ready(() => {
            loadTelegramData();
            validateStep(1);
        });

        function loadTelegramData() {
            const tg = tgApp.tg;
            const telegramDataDiv = document.getElementById('telegram-data');
            
            if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                telegramDataDiv.innerHTML = `
                    <div><strong>üë§ ID:</strong> ${user.id}</div>
                    <div><strong>üëã –ò–º—è:</strong> ${user.first_name} ${user.last_name || ''}</div>
                    <div><strong>üì± Username:</strong> @${user.username || '–Ω–µ —É–∫–∞–∑–∞–Ω'}</div>
                `;
                
                // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏
                const nameInput = document.getElementById('user-name');
                if (user.first_name) {
                    nameInput.value = user.first_name + (user.last_name ? ' ' + user.last_name : '');
                    validateInput(nameInput);
                }
                
                formData.telegramId = user.id;
                formData.telegramUsername = user.username;
            } else {
                telegramDataDiv.innerHTML = `
                    <div style="color: #f44336;">
                        ‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ Telegram –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞.
                    </div>
                `;
            }
        }

        function validateInput(input) {
            const errorDiv = document.querySelector(`#${input.id.replace('-', '-').split('-')[0]}-error, #${input.id}-error`);
            let isValid = true;

            input.classList.remove('error');
            if (errorDiv) errorDiv.style.display = 'none';

            if (input.type === 'text' && input.hasAttribute('minlength')) {
                if (input.value.length < parseInt(input.getAttribute('minlength'))) {
                    isValid = false;
                }
            }

            if (input.type === 'tel') {
                const phoneRegex = /^[\+]?[0-9\s\-\(\)]{10,}$/;
                if (!phoneRegex.test(input.value)) {
                    isValid = false;
                }
            }

            if (input.id === 'city') {
                const cityRegex = /^[–ê-–Ø–∞-—è–Å—ë\s\-]+$/;
                if (!cityRegex.test(input.value) || input.value.length < 2) {
                    isValid = false;
                }
            }

            if (!isValid && errorDiv) {
                input.classList.add('error');
                errorDiv.style.display = 'block';
            }

            return isValid;
        }

        function validateStep(step) {
            let isValid = false;
            const nextButton = document.getElementById(`next-${step}`);

            switch(step) {
                case 1:
                    const name = document.getElementById('user-name');
                    const phone = document.getElementById('user-phone');
                    isValid = name.value.length >= 3 && 
                             /^[\+]?[0-9\s\-\(\)]{10,}$/.test(phone.value);
                    break;
                    
                case 2:
                    const timezone = document.getElementById('timezone');
                    const city = document.getElementById('city');
                    isValid = timezone.value !== '' && 
                             /^[–ê-–Ø–∞-—è–Å—ë\s\-]+$/.test(city.value) && 
                             city.value.length >= 2;
                    break;
                    
                case 3:
                    const childName = document.getElementById('child-name');
                    const childAge = document.getElementById('child-age');
                    const gender = document.querySelector('input[name="child-gender"]:checked');
                    isValid = childName.value.length >= 2 && 
                             childAge.value !== '' && 
                             gender !== null;
                    break;
                    
                case 4:
                    const privacy = document.getElementById('privacy-agreement');
                    isValid = privacy.checked;
                    break;
            }

            if (nextButton) {
                nextButton.disabled = !isValid;
            }

            return isValid;
        }

        function nextStep(step) {
            if (!validateStep(step)) return;

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
            saveStepData(step);

            // –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —à–∞–≥
            document.getElementById(`content-${step}`).classList.add('hidden');
            document.getElementById(`step-${step}`).classList.remove('active');
            document.getElementById(`step-${step}`).classList.add('completed');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥
            currentStep = step + 1;
            document.getElementById(`content-${currentStep}`).classList.remove('hidden');
            document.getElementById(`step-${currentStep}`).classList.add('active');

            // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É Telegram
            updateTelegramButton();
            
            // –í–∞–ª–∏–¥–∏—Ä—É–µ–º –Ω–æ–≤—ã–π —à–∞–≥
            setTimeout(() => validateStep(currentStep), 100);
        }

        function prevStep(step) {
            // –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —à–∞–≥
            document.getElementById(`content-${step}`).classList.add('hidden');
            document.getElementById(`step-${step}`).classList.remove('active');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —à–∞–≥
            currentStep = step - 1;
            document.getElementById(`content-${currentStep}`).classList.remove('hidden');
            document.getElementById(`step-${currentStep}`).classList.remove('completed');
            document.getElementById(`step-${currentStep}`).classList.add('active');

            updateTelegramButton();
        }

        function saveStepData(step) {
            switch(step) {
                case 1:
                    formData.userName = document.getElementById('user-name').value;
                    formData.userPhone = document.getElementById('user-phone').value;
                    break;
                case 2:
                    formData.timezone = document.getElementById('timezone').value;
                    formData.city = document.getElementById('city').value;
                    break;
                case 3:
                    formData.childName = document.getElementById('child-name').value;
                    formData.childAge = document.getElementById('child-age').value;
                    formData.childGender = document.querySelector('input[name="child-gender"]:checked').value;
                    break;
                case 4:
                    formData.privacyAccepted = document.getElementById('privacy-agreement').checked;
                    formData.notificationsAccepted = document.getElementById('notifications-agreement').checked;
                    break;
            }
        }

        function updateTelegramButton() {
            if (tgApp.tg) {
                switch(currentStep) {
                    case 1:
                        tgApp.setMainButton('–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Üí', () => nextStep(1));
                        break;
                    case 2:
                        tgApp.setMainButton('–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Üí', () => nextStep(2));
                        break;
                    case 3:
                        tgApp.setMainButton('–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Üí', () => nextStep(3));
                        break;
                    case 4:
                        tgApp.setMainButton('üéâ –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é', completeRegistration);
                        break;
                }
                tgApp.showMainButton();
            }
        }

        function completeRegistration() {
            if (!validateStep(4)) return;

            saveStepData(4);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å
            const button = document.getElementById('next-4');
            button.innerHTML = 'üîÑ –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ...';
            button.disabled = true;

            if (tgApp.tg) {
                tgApp.tg.MainButton.showProgress();
            }

            // –ò–º–∏—Ç–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
            setTimeout(() => {
                console.log('–î–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', formData);
                
                // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                tgApp.navigateTo('/welcome');
            }, 2000);
        }

        function showPrivacyPolicy() {
            if (tgApp.tg) {
                tgApp.tg.showPopup({
                    title: '–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏',
                    message: 'Family Habits –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ú—ã –Ω–µ –ø–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º –∏—Ö –∑–∞—â–∏—Ç—É.',
                    buttons: [{type: 'ok', text: '–ü–æ–Ω—è—Ç–Ω–æ'}]
                });
            } else {
                alert('Family Habits –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.');
            }
        }

        // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        document.addEventListener('DOMContentLoaded', () => {
            // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π
            ['user-name', 'user-phone', 'city', 'child-name'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', () => {
                        validateInput(input);
                        validateStep(currentStep);
                    });
                }
            });

            // –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–µ–ª–µ–∫—Ç–æ–≤
            ['timezone', 'child-age'].forEach(id => {
                const select = document.getElementById(id);
                if (select) {
                    select.addEventListener('change', () => validateStep(currentStep));
                }
            });

            // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–¥–∏–æ –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('input[name="child-gender"]').forEach(radio => {
                radio.addEventListener('change', () => validateStep(currentStep));
            });

            // –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ–∫–±–æ–∫—Å–∞
            const privacyCheck = document.getElementById('privacy-agreement');
            if (privacyCheck) {
                privacyCheck.addEventListener('change', () => validateStep(currentStep));
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        window.onerror = function(msg, url, line, col, error) {
            console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', msg, error);
        };
    </script>
</body>
</html>