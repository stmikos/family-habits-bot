# üå± Family Habits - Telegram WebApp Integration

## ‚úÖ –°—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**M2 —Ñ–∞–∑–∞ –ó–ê–í–ï–†–®–ï–ù–ê!** –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Telegram Bot + WebApp –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

## üöÄ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### ü§ñ Telegram Bot
- ‚úÖ aiogram 3.x —Å WebApp –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –ö–Ω–æ–ø–∫–∏ WebApp –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –°–µ–º–µ–π–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (Parent/Child)

### üåê WebApp Frontend
- ‚úÖ 8 –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
- ‚úÖ Telegram WebApp API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
- ‚úÖ –ó–µ–ª–µ–Ω–∞—è –ø—Ä–∏—Ä–æ–¥–Ω–∞—è —Ç–µ–º–∞ —Å –•–∞–±–∏—Ç –∏ –•–∞–±–±–∏
- ‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏ –∞–Ω–∏–º–∞—Ü–∏–∏

### üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ FastAPI —Å–µ—Ä–≤–µ—Ä –¥–ª—è WebApp
- ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Telegram
- ‚úÖ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

## üì± –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | WebApp —Å—Ç—Ä–∞–Ω–∏—Ü–∞ |
|---------|----------|----------------|
| `/app` –∏–ª–∏ `/start` | –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | index.html |
| `/family` | –°–µ–º–µ–π–Ω–∞—è –ø–∞–Ω–µ–ª—å | index.html?tab=family |
| `/tasks` | –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á | create-task.html |
| `/shop` | –ú–∞–≥–∞–∑–∏–Ω –Ω–∞–≥—Ä–∞–¥ | shop.html |
| `/profile` | –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | profile.html |
| `/stats` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | statistics.html |

## üõ†Ô∏è –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### 1. –ó–∞–ø—É—Å–∫ –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: WebApp —Å–µ—Ä–≤–µ—Ä
cd /workspaces/family-habits-bot/webapp
python3 server.py

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: Telegram Bot
cd /workspaces/family-habits-bot
python3 run_bot.py
```

**–î–æ—Å—Ç—É–ø–Ω–æ —Å–µ–π—á–∞—Å:**
- üåê WebApp: http://localhost:8000
- ü§ñ Bot: –¥–µ–º–æ-—Ä–µ–∂–∏–º (–ø–æ–∫–∞–∂–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏)

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ Telegram –±–æ—Ç–∞

#### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω
1. –ù–∞–ø–∏—à–∏—Ç–µ @BotFather –≤ Telegram
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞: `/newbot`
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω

#### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env
```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ –≤ —Ñ–∞–π–ª–µ .env
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–æ—Ç_BotFather
WEBAPP_URL=https://–≤–∞—à-–¥–æ–º–µ–Ω.com  # –∏–ª–∏ ngrok URL
```

#### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å WebApp –≤ –±–æ—Ç–µ
1. –û—Ç–∫—Ä–æ–π—Ç–µ @BotFather
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
3. `/setmenubutton` ‚Üí `@–≤–∞—à_–±–æ—Ç`
4. –í–≤–µ–¥–∏—Ç–µ:
   - **–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏:** `üå± Family Habits`
   - **URL:** `https://–≤–∞—à-–¥–æ–º–µ–Ω.com`

#### –®–∞–≥ 4: –ó–∞–ø—É—Å–∫
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
./start.sh
```

## üåç –î–µ–ø–ª–æ–π –≤ –ø—Ä–æ–¥–∞–∫—à–Ω

### –û–ø—Ü–∏—è 1: Render/Railway/Heroku
1. –°–æ–∑–¥–∞–π—Ç–µ –¥–≤–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
   - **Backend:** `/workspaces/family-habits-bot/webapp/`
   - **Bot:** `/workspaces/family-habits-bot/`

2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω
WEBAPP_URL=https://–≤–∞—à-webapp.render.com
DATABASE_URL=postgres://...
```

### –û–ø—Ü–∏—è 2: VPS/Cloud
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
pip install -r webapp/requirements.txt
```

2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ reverse proxy (nginx):
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å systemd –∏–ª–∏ supervisor

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
/workspaces/family-habits-bot/
‚îú‚îÄ‚îÄ webapp/                          # WebApp Frontend
‚îÇ   ‚îú‚îÄ‚îÄ server.py                   # FastAPI —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ telegram-webapp.js          # Telegram WebApp API
‚îÇ   ‚îú‚îÄ‚îÄ design-system.css           # –î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞
‚îÇ   ‚îú‚îÄ‚îÄ index.html                  # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ registration.html           # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–µ–º—å–∏
‚îÇ   ‚îú‚îÄ‚îÄ registration-children.html  # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ç–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ welcome.html                # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ create-task.html            # –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á
‚îÇ   ‚îú‚îÄ‚îÄ shop.html                   # –ú–∞–≥–∞–∑–∏–Ω –Ω–∞–≥—Ä–∞–¥
‚îÇ   ‚îú‚îÄ‚îÄ profile.html                # –ü—Ä–æ—Ñ–∏–ª—å
‚îÇ   ‚îî‚îÄ‚îÄ statistics.html             # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îú‚îÄ‚îÄ app/bot/handlers/webapp.py      # Telegram –∫–æ–º–∞–Ω–¥—ã
‚îú‚îÄ‚îÄ start.sh                       # –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
‚îî‚îÄ‚îÄ .env                           # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
```

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º

### üè† **index.html** - –ì–ª–∞–≤–Ω–∞—è
- –î–∞—à–±–æ—Ä–¥ —Å–µ–º—å–∏
- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
- –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∑–∞–¥–∞—á–∞–º
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–Ω—è

### üë®‚Äçüë©‚Äçüëß‚Äçüë¶ **registration.html** - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–º–µ–π–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
- –í—ã–±–æ—Ä —Ä–æ–ª–∏ (–†–æ–¥–∏—Ç–µ–ª—å)
- –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### üë∂ **registration-children.html** - –î–µ—Ç–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ç–µ–π –≤ —Å–µ–º—å—é
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤–∞—Ç–∞—Ä–æ–≤
- –í–æ–∑—Ä–∞—Å—Ç –∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã

### üéâ **welcome.html** - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
- –ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π
- –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- –ü–µ—Ä–≤—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ **create-task.html** - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á
- –®–∞–±–ª–æ–Ω—ã –∑–∞–¥–∞—á
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
- –°–∏—Å—Ç–µ–º–∞ –Ω–∞–≥—Ä–∞–¥

### üõçÔ∏è **shop.html** - –ú–∞–≥–∞–∑–∏–Ω
- –ü–æ–∫—É–ø–∫–∞ –Ω–∞–≥—Ä–∞–¥ –∑–∞ –∑–≤–µ–∑–¥—ã
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
- –°–µ–º–µ–π–Ω—ã–µ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è
- –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫

### üë§ **profile.html** - –ü—Ä–æ—Ñ–∏–ª—å
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ —É—Ä–æ–≤–Ω–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–º—å–µ–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### üìä **statistics.html** - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- –ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- –°–µ–º–µ–π–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥
- –ò–Ω—Å–∞–π—Ç—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

## üîß API Integration

### –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã WebApp
- `POST /api/telegram/user-data` - –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/tasks/create` - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á
- `POST /api/shop/purchase` - –ü–æ–∫—É–ø–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
- `GET /api/user/{user_id}/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### Sync —Å Telegram Bot
WebApp –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞ —á–µ—Ä–µ–∑:
- Telegram WebApp API (initData)
- REST API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- Shared database

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ WebApp
```bash
curl http://localhost:8000/health
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: {"status": "ok", "message": "Family Habits WebApp is running"}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
- ‚úÖ http://localhost:8000/index.html
- ‚úÖ http://localhost:8000/registration.html
- ‚úÖ http://localhost:8000/shop.html

### –õ–æ–≥–∏
- **WebApp:** uvicorn –ª–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
- **Bot:** –ª–æ–≥–∏ –≤ —Ñ–∞–π–ª `/workspaces/family-habits-bot/logs/`

## üéä –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

**Family Habits** –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:
- ü§ñ Telegram Bot —Å WebApp –∫–Ω–æ–ø–∫–∞–º–∏
- üåê Responsive WebApp —Å 8 —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏  
- üîó –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram WebApp API
- üé® –î–∏–∑–∞–π–Ω —Å –•–∞–±–∏—Ç –∏ –•–∞–±–±–∏ —Ç–∞–ª–∏—Å–º–∞–Ω–∞–º–∏
- üì± –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:** –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω —É @BotFather –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–¥–∞–∫—à–Ω –¥–µ–ø–ª–æ–π! üöÄ